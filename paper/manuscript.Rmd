---
title: "Keystoneness, centrality, and the structural controllability of ecological networks"
classoption: a4paper
csl: journal-of-ecology.csl
output: 
  bookdown::pdf_document2: 
    keep_tex: yes
    number_sections: false
toc: false
header-includes:
- \usepackage{geometry}
# - \geometry{right=3in,marginparwidth=2.5in}
- \usepackage{setspace}
- \usepackage{float}
- \usepackage{booktabs}
- \usepackage{caption}
- \usepackage{lineno}
- \newcommand{\R}[1]{\label{#1}\linelabel{#1}}
- \newcommand{\lr}[1]{page~\pageref{#1}, line~\lineref{#1}}
- \usepackage{xr}
- \externaldocument[S-]{supp-info}
- \usepackage{siunitx}
- \usepackage{multirow}
- \usepackage{makecell}
- \usepackage{threeparttablex}
documentclass: artikel1
bibliography: phd-bibliography/network-control.bib
---

\doublespacing
\linenumbers

**E. Fernando Cagua^1^, Kate L. Wootton^1,2^, Daniel B. Stouffer^1^**

^1^ Centre for Integrative Ecology, School of Biological Sciences, University of Canterbury, Private Bag 4800, Christchurch 8041, New Zealand

^2^ Current address: Department of Ecology, Swedish University of Agricultural Sciences, Box 7044, SE-750 07 Uppsala, Sweden

**Author for correspondence:** Daniel B. Stouffer (daniel.stouffer@canterbury.ac.nz) - +64 3 364 2729 - Centre for Integrative Ecology, School of Biological Sciences, University of Canterbury, Private Bag 4800, Christchurch 8140, New Zealand

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, 
                      warning = FALSE)
options(knitr.kable.NA = '')
library(ggplot2)
```

```{r load-metadata}
drake::loadd(metadata)
lop <- dplyr::filter(metadata, study == "lopezaraiza") %>% 
  dplyr::mutate(size = n_pla + n_pol) %$% size %>% summary() 
bar <- dplyr::filter(metadata, study == "bartomeus") %>% 
  dplyr::mutate(size = n_pla + n_pol) %$% size %>% summary() 
```

<!-- *Alternative titles:*  -->
<!-- * Structural controllability of ecological networks -->


\clearpage

# Abstract

1. An important dimension of a species' role is its ability to alter the state and maintain the diversity of its community. 
Centrality metrics have often been used to identify these species, which are sometimes referred as "keystone" species. 
However, the relationship between centrality and keystoneness is largely phenomenological and based mostly on our intuition regarding what constitutes an important species. 
While centrality is useful when predicting which species' extinctions could cause the largest change in a community, it says little about how these species could be used to attain or preserve a particular community state.

2. Here we introduce structural controllability, an approach that allows us to quantify the extent to which network topology can be harnessed to achieve a desired state. 
\R{R2-define-control-capacity} It also allows us to quantify a species' control capacity—its relative importance—and identify the set of species that, collectively, are critical in this context because they have largest possible control capacity. 
We illustrate the application of structural controllability with ten pairs of uninvaded and invaded plant-pollinator communities.

3. We found that the controllability of a community is not dependent on its invasion status, but on the asymmetric nature of its mutual dependences. 
While central species were also likely to have a large control capacity, centrality fails to identify species that, despite being less connected, were critical in their communities. 
\R{R2-our-dataset} Interestingly, this set of critical species was mostly composed of plants and included every invasive species in our dataset. 
We also found that species with high control capacity, and in particular critical species, contribute the most to the stable coexistence of their community.
\R{R2-species-degree} This result was true, even when controlling for the species' degree, abundance/interaction strength, and the relative dependence of their partners. 

4. *Synthesis*: Structural controllability is strongly related to the stability of a network and measures the difficulty of managing an ecological community.
It also identifies species that are critical to sustain biodiversity and to change or maintain the state of their community and are therefore likely to be very relevant for management and conservation. 

**Keywords:** Keystone species, management interventions, mutualism, network control theory, plant population and community dynamics, species' importance, control capacity, structural stability, controllability

\clearpage

# Introduction

A major goal in ecology is to understand the roles played by different species in the biotic environment.
Within community ecology, a complex-systems approach has led to the development of a variety of analytical and simulation tools with which to compare and contrast the roles of species embedded in a network of interactions [@guimera_cartography_2005; @bascompte_assembly_2009; @stouffer_evolutionary_2012; @coux_linking_2016].
A particularly relevant dimension of any species' role is its ability to alter the abundance of other species and the state of the community—since changes of this nature can have knock-on effects on ecosystem function, diversity, processes, and services [@thompson_food_2012; @tylianakis_global_2008; @tylianakis_conservation_2010].
This ability is sometimes referred to as a species' "keystoneness" [@mills_keystone-species_1993]. 

A significant proportion of the network tools used to estimate species' roles in this context rely on the calculation of a species' centrality—a relative ranking of its positional importance that originally stems from social-network research [@noah_e._friedkin_theoretical_1991; @martin_gonzalez_centrality_2010]. 
Generally speaking, central species tend to be better connected and consequently are more likely to participate in the network's "food chains". 
Because species that participate in more chains are more likely to affect the abundances of other species, centrality metrics have often been used to identify keystone species in the community [@jordan_quantifying_2007]. 
Centrality metrics have been shown to be useful tools to rank species in regard to their potential to alter the abundances of other species, in particular when estimating the probability of secondary extinctions that may follow the loss of a species [@dunne_network_2002; @kaiser-bunbury_robustness_2010].

Despite being conceptually intuitive, the relationship between centrality and a species' presumed impact on the state of the community is largely phenomenological. 
On the one hand, substantive changes in ecosystem functioning can also occur without complete removal of a species [@mouillot_functional_2013].
On the other, we are often interested in a *specific* state of the community that might be desirable to attain (or preserve) because of its biodiversity, resilience, functioning, or the ecosystem services it provides. 
In these cases, it might be less useful to understand which species may cause *any* change in the community. 
Instead, we are better served by understanding how the structure of the network can be harnessed to achieve the desired state and which species may play the largest role in this targeted process. 
When the state of a community is underpinned by more than a single species (often the case in real communities) and we move beyond single-species removals, we might expect the accuracy of centrality to diminish.
As a result, community ecology could arguably benefit from an alternative, perhaps more mechanistically-grounded, approach to understand how species affect each other's abundance. 

Species' abundances---and consequently the state of the community as a whole---are influenced both by the structure of their interactions and the dynamics of these interactions, including the mechanisms of self-regulation [@lever_sudden_2014]. 
However, community and population dynamics can be modelled in innumerable ways, and empirical support for one versus another is often still ambiguous [@holland_population_2002]. 
The alternative approach should, therefore, ideally acknowledge ecosystem dynamics, but without being overly dependent on the particular choices of how they are characterised.
Among the various possibilities *structural controllability*, a branch of control theory, appears to be a strong candidate [@isbell_human_2013]. 
Control theory is a widely-studied branch of engineering used to determine and supervise the behaviour of dynamical systems [@motter_networkcontrology_2015]. 
It is inherently designed to deal with system feedbacks and its application has recently been expanded to complex networks [@lin_structural_1974;  @liu_control_2016]. 
Consistent with long-standing ecological questions, advances in structural controllability have established a clear link between the structure of the network and the way nodes affect each other. 
Unlike centrality indices, however, this link is not based on a priori assumptions between network metrics and keystoneness but is instead based on well-established advances in both dynamical and complex-systems theory [@motter_networkcontrology_2015].

At its fundamental level, structural controllability first determines whether a system is controllable or not; that is, it asks if a system could ever be driven to a desired state within a finite amount of time. 
Although the controllability of a network is a whole-system property, it has recently been shown that asking for the controllability of a complex-system is equivalent to finding a particular set of relevant nodes: the set with which is possible to control the state of the whole network [@liu_control_2016].
Importantly, this set of nodes is not always unique for a given network.
This implies that an examination of the distinct sets provides a means to connect nodes with their *general* ability to modify the system to which they belong.

Here, we apply methods from structural controllability to a particular ecological problem and show how it can be used to generate insight into the role of species in an ecological network. 
Specifically, we outline the approach using a set of ten pairs of uninvaded and invaded plant-pollinator communities. 
We use invaded communities because there is strong empirical evidence showing that invasive species play an important role shaping the abundances of other species, something which is particularly true in these ten networks [@lopezaraizamikel_impact_2007; @bartomeus_contrasting_2008]. 
This choice thus offers us an opportunity to explicitly contrast our theoretical observations with empirical evidence.
Moreover, empirical observations indicate that steering the state of some communities—for example during ecosystem restoration or invasive species removal—can be a very difficult task [@woodford_confronting_2016]. 
Therefore, we first ask whether there are differences between the controllability of invaded and uninvaded networks. 
\R{R2-ref-glossary} We then expand existing methods from control theory to effectively link the *controllability* (Table \@ref(tab:tab-glossary)) of a network with the role of its constituent species.
We ask—from a control-theoretic perspective—whether there are key differences between species in the role they play at driving the state of the community and explore the ecological factors related to these differences. 
This allows us to identify species that might be critical for network control and show that they have a larger than expected impact on the stable coexistence of the community.
Finally, we compare the proposed approach to current methods based on species' centrality and show how these methods are indeed valuable but ultimately paint a limited picture in regard to the "keystoneness" of a species.

```{r tab-glossary}
defs <- list(
  "network control" = "A network is said to be controllable if it is possible to steer it from an initial to an arbitrary final state within finite time.",
  "controllability" = "The intrinsic difficulty of controlling an ecological community. It is measured by the relative size of the minimum driver-node set, $n_D$. It also indicates the extent to which network structure can be harnessed for network control.", 
  "minimum driver-node set" = "One of the sets of species whose abundances need to be directly managed in order to achieve full control of the community. The minimum driver-node sets can be obtained by finding all maximum matchings in a network.",
  "maximum matching" = "A matching is a set of links that do not share any common start or end nodes; the largest possible matching is called a maximum matching.",
  "control configuration" = "One of the species combinations with which is possible to achieve network control. Optimal control configurations are given by the minimum driver-node sets.", 
  "control capacity" = "The relative frequency \\(\\phi\\) which with a species is part of the optimal control configurations of a network.", 
  "critical species" = "A species with a maximal control capacity \\(\\phi=1\\)",
  "superior node" = "A species is a superior node if it can internally affect the abundance of other species in the network. Superior nodes make up the chains that propagate the control signals through the network.")

dplyr::data_frame(rows = c(rbind(names(defs), unlist(defs))), dummy2 = "") %>%
  dplyr::mutate(rows = kableExtra::cell_spec(rows, "latex", bold = T:F, escape = F)) %>%
  knitr::kable("latex", 
               booktabs = T, 
               col.names = NULL,
               caption = "Glossary", 
               escape = F, 
               linesep = c('', '\\addlinespace')) %>% 
  kableExtra::kable_styling(font_size = 8) %>%
  kableExtra::add_indent(seq(2, length(defs)*2, by = 2)) %>%
  kableExtra::column_spec(1, width = paste0(fig_sizes()[[1]], "in"))
```

# Materials and methods

We used ten paired pollination communities to apply the control-theoretic approach.
Each community pair was composed of a community invaded by a plant and a community free of the invasive species. 
Four pairs correspond to natural or semi-natural vegetation communities in the city of Bristol, UK [@lopezaraizamikel_impact_2007]. 
These communities comprised `r lop[1]`--`r lop[6]` species (mean `r round(lop[4])`), and non-invaded plots were obtained by experimentally removing all the flowers of the invasive species *Impatients grandulifera*.
The other six pairs were obtained from lower diversity Mediterranean shrublands in Cap de Creus National Park, Spain [@bartomeus_contrasting_2008].
These communities comprised `r bar[1]`--`r bar[6]` species (mean `r round(bar[4])`); in contrast to the above, uninvaded communities were obtained from plots that had not yet been colonised by either of the invasive species *Carpobrotus affine acinaciformis* or *Opuntia stricta*. The structure of all these communities was defined by the pollinator visitation frequency, which has been shown to be an appropriate surrogate for interspecific effects in pollination networks [@vazquez_interaction_2005; @bascompte_asymmetric_2006]. 
Full details about the empirical networks can be found in the Supporting Information Section \@ref(S-empirical-networks). 

The first step in applying methods of control theory is to construct a directed network that is able to provide an indication of the extent to which species affect each other's abundance. 
In some ecological networks, establishing the directionality can be relatively straightforward, for example when links represent biomass transfer or energy flow [@isbell_human_2013]. 
In pollination networks, however, this directionality is less obvious as both species can, in theory, benefit from the interaction. 
We overcome that obstacle by noting that the extent to which species *i* affects species *j* relative to the extent to which *j* affects *i* can be summarised by their interaction asymmetry [@bascompte_asymmetric_2006]. 
This asymmetry is given by $$a(i,j) = a(j,i) = \frac{\left | d_{ij}-d_{ji} \right |}{max\left ( d_{ij}, d_{ji} \right )},$$ where the dependence of plant *i* on pollinator *j*, *d~ij~*, is the proportion of the visits from pollinator *j* compared to all pollinator visits to plant *i*. 
Previous research has shown that mutualistic interactions are often highly asymmetric in natural communities; in other words, if a plant species is largely dependent on a pollinator species, that pollinator tends to depend rather weakly on the plant (and vice versa). 
We therefore create a directed link from species *i* to species *j* when $d_{ij}-d_{ji} \geq 0$ to establish the most likely direction of control between a species pair (Figure \@ref(fig:fig-example-networks)a).
Sometimes there is no observed asymmetry between species pairs ($d_{ij}=d_{ji}$), and we cannot infer a dominant direction of control. 
When this occurs, we deem both species to be equally likely to affect each other and leave a reciprocal interaction between them (a link from *i* to *j* and another from *j* to *i*). 
By basing the direction of the links on the asymmetry of their dependence, we are able to generate a network that is consistent with the dynamics of the community while satisfying the requirements of structural controllability. 
This allows us to calculate the controllability of the networks and investigate whether there are differences between invaded and uninvaded communities. 

```{r load-fig-example-networks}
drake::loadd(fig_struct_control)
```

```{r fig-example-networks, fig.width=fig_struct_control$width, fig.height=fig_struct_control$height, fig.cap="The direction of control and controllability conditions. (a) To establish the direction of control, we start with a weighted visitation network (on the left). In this network, the width of the links corresponds to the frequency of visitation between animals $a_i$ and plants $p_i$, with wider links indicating more visits. Plant $p_1$ is visited exclusively by $a_1$ but $p_1$ represents only a small fraction of the floral resources exploited by $a_1$. Therefore, the population of $p_1$ is more likely to be affected by $a_1$ than vice versa. We represent this with a directed link from $a_1$ to $p_1$ in the control network (on the right). The direction of control between all other species pairs can be similarly determined by inspecting the difference between their relative dependences. (b) Once we have established the directions of control, we can determine whether the network is controllable or not. Any system defined by a directed network (with state nodes $x_i$; species' populations in an ecological context) and external control inputs (nodes $u_i$, orange links) is structurally controllable if it satisfies two conditions: it has no dilations (expansions in the network) and no inaccessible nodes. The system on the top left is not controllable because there is a dilation since node $x_2$ is being used to control two nodes simultaneously; in other words, there are fewer superiors ($x_2$) than subordinates ($x_1$ and $x_3$). The network on the top right is not controllable because node $x_3$ is inaccessible for the only input node $u_1$ in the system. Both systems can be made controllable by adding an extra input node ($u_2$ in both bottom networks)."}
replayPlot(fig_struct_control$plot)
```

## Controllability

A system is said to be controllable if it is possible to steer it from an initial to an arbitrary final state within finite time [@kalman_mathematical_1963]. 
A simple version of such a system can be described by $\frac{dx}{dt} = Ax + Bu(t)$, where the change of its state over time ($\frac{dx}{dt}$) depends on its current state *x* (for example the species' abundances), an external time-varying input *u(t)* (the control signal), and two matrices *A* and *B*, which encode information about the network structure and how species respond to external inputs, respectively. 
In classic control theory, determining whether this system is controllable can be achieved by checking that its controllability matrix $R= [ \begin{matrix}B & AB & A^{2}B & ...& A^{n-1}B\end{matrix} ]$ has full rank. 
In complex systems, however, employing this rank condition, or numerical approximations of it is infeasible because it is hard to fully parameterise *A* and *B* (either because the weight of the links changes over time or because they are difficult to measure). 
Here, we use an approach based on the structural controllability theorem [@lin_structural_1974], which assumes that we are confident about which elements of *A* and *B* have either non-zero or zero values (there is an interaction or not), but that we are less sure about the precise magnitude of the non-zero values. 
Using this structural approach, we can find out the controllability of a system for every non-zero realisation of the parameters.

We are often able to estimate *A* in ecological networks, as this matrix represents the interactions between species. 
Part of the control problem thus resides in estimating a supportable estimation of *B*, which represents the links between external inputs and species. 
Naively, any ecological community (and any system for that matter) could be controlled if we control the state of every species independently, but such an approach is typically impractical. 
Here, we are interested in finding a minimum driver-node set (effectively finding *B*) with which to make the system controllable. 
The brute-force search for this minimum driver-node set is computationally prohibitive for most networks as it involves the evaluation of $2^N$ different controllability matrices where $N$ is the number of species in the community. 
We therefore instead employ a recently-developed approach that shows that the control problem of finding the minimum driver-node set can be mapped into a graph-theoretic problem: maximum matching [@liu_controllability_2011; @liu_control_2016].

Maximum matching is a widely studied topic in graph theory and is commonly used in multiple applications, ranging from dating apps and wireless communications to organ transplant allocation and peer-to-peer file sharing. 
A matching in an unweighted directed graph is defined as a set of links that do not share common start or end nodes; the largest possible matching is called a maximum matching. 
For example, in a network composed of jobs and job applicants, a matching is any pairing between applicants and positions that satisfies one basic constraint: an applicant can be assigned to at most one position and vice versa.
Consequently, a maximum matching is an optimal pairing, one that maximises the number of applicants with jobs and the number of positions filled. 
Admittedly, the link between matchings and structural controllability may appear far from straightforward. 

This link becomes apparent after examining the graphical interpretation of structural controllability: from a topological perspective, a network is structurally controllable if there are no inaccessible nodes—that is, nodes without incoming links—or dilations—*expansions* of the network (Figure \@ref(fig:fig-example-networks)b; Supporting Information Section \@ref(S-structural-controllability)).
The key is to note that these two fundamental conditions of structural controllability imply that there is a one-to-one relationship between *superior* and *subordinate* nodes just like the one-to-one relationship between jobs and applicants (Figure \@ref(fig:fig-example-networks)b, bottom left). 
We thus use the maximum-matching algorithm to find an optimal pairing of superior (those that can control another node) and subordinate nodes (those that can be controlled by another node) in a manner consistent with the controllability conditions (Supporting Information Section \@ref(S-one-maximum-matching)). 
Given the result, we can further decompose the matching into a set of paths that reveal how a control signal can flow across the links in a network to reach every node within it. 
As recently shown [@liu_controllability_2011], the minimum driver-node set---those to which an external control input should be applied to make the system controllable---corresponds exactly to the *unmatched* nodes in the network (Figure \@ref(fig:fig-control-configuration)).

```{r load-fig-control-configuration}
drake::loadd(fig_control_config)
```

```{r fig-control-configuration, fig.height=fig_control_config$height, fig.width=fig_control_config$width,fig.cap = "Maximum matchings and control configurations. In directed networks, a maximum matching is the largest possible set of links that do not share start or end nodes (dark purple). Maximum matchings are not necessarily unique; instead, each of them is related to a possible minimum driver-node set in the network (the nodes to which an external control input, in orange, should be applied in order to ensure controllability). The size of the minimum driver-node set *D* corresponds exactly to the number of unmatched nodes (the number of nodes in the network *N* minus the matching size). To account for network size, we use the size of the minimum driver-node set relative to the total number of nodes *n~D~ = D/N* as a measure of the extent to which the network structure can be harnessed to control the system."}
replayPlot(fig_control_config$plot)
```

## Differences between invaded and uninvaded networks

\R{R2-ecol-objective} Our first objective is to investigate whether the controllability of a community is associated with invasion status or not. 
\R{R2-desired-control-trajectory} Finding out exactly how difficult it is to control a network depends strongly on the particularities of the desired control trajectory (i.e. path to the desired final state)  as well as the dynamical relationship between nodes. 
However, we are interested in understanding the controllability of a network in a more general sense, such that it can be applied even when the precise control scenario is known only incompletely. 
To this end, we chose an indicator that follows directly from our approach: the size of the minimum driver-node set. 
This simple metric provides a general indication of how difficult controlling a network might be, as systems that require a large number of external inputs to be fully controlled are intuitively more difficult or costly to manage. 
For instance, achieving full control in a "network" in which species do not interact at all is relatively more difficult as we would require an intervention for every single species. 
Conversely, the structure of a linear trophic chain can be harnessed to achieve full control using just one intervention targeted at the top species; a suitable control signal could then cascade through the trophic levels and reach other species in the community. 
Specifically, drawing from the structural-controllability literature, we use the size of the minimum driver-node set relative to the total number of species $n_D = \frac{D}{N}$ as a measure of the *controllability* of a network—the extent to which the network structure can be harnessed to control the community.
The lower $n_D$ the more controllable the community. 
In an ecological context, external inputs can be thought of as management interventions that modify the abundance of a particular species. 

After finding the minimum driver-node set in each of our networks, we wanted to test whether invasion status or other predictors are correlated to controllability. 
We do this using a set of generalised linear models with binomial error structure. 
The response variable was the relative size of the minimum driver-node set $n_D$ of the twenty empirical networks (ten invaded and ten uninvaded), and we included invasion status as a predictor. 
As predictors, we also include the network connectance, the network nestedness (NODF), the number of species [since one might naively expect to see a negative relationship between richness and controllability; @menge_indirect_1995], the network asymmetry (an indication of the balance between plant and pollinator diversity), and the interaction strength asymmetry [the asymmetry on the dependences between trophic levels; @bluthgen_specialization_2007]\R{R2-citation-with-name}.
We compared models using the Akaike Information Criterion for small sample sizes (AICc). 

In addition, we also explored whether real networks differ in their architecture from random ones in a concerted way that could impact these results. 
Specifically, we used two null models each with 99 randomisations per network. 
In the first, we followed @vazquez_species_2007 and maintained the connectance of the network but randomised the visits across species such that the relative probabilities of interactions were maintained. 
We then re-estimated the direction of control and the corresponding size of the minimum driver-node set, $n_D$. 
For the second null model, we used the empirical directed network described above and randomly shuffled the direction of control between a species pair prior to re-estimating the size of the minimum driver-node set.

## Species' roles

Our second objective is related to how species differ in their ability to drive the population dynamics of the community. 
We in turn examine whether these differences are also reflected in the role species play at supporting the stable coexistence of other species in the community. 
Ecologically, these differences are relevant because resources and data are limited, and therefore full control is infeasible. 
While calculating the size of the minimum drive-node set can measure the controllability of an ecological community, it does not provide information about the roles that particular species play. 

To answer this question, we harness the fact there may be multiple maximum matchings for a given network, and each of these maximum matchings indicates a unique combination of species with which it is possible to control the network. 
Moreover, some species belong to these combinations more often than do others. 
We call this property a species' "control capacity", $\phi$. 
The higher a species' control capacity, the greater the likelihood that it would need to be directly managed to change (or maintain) the ecological state of their community. 
Therefore, a species' control capacity provides an estimation of its relative importance at driving the state of the community [@jia_control_2013]. 

To calculate a species' control capacity $\phi$, we must first enumerate all possible maximum matchings (Supporting Information Section \@ref(S-all-maximum-matching)). 
Unfortunately, enumerating all maximum matchings is extremely expensive from a computational perspective—a network with a couple dozen species has several hundred million unique maximum matchings. 
To solve this problem, we employ a recently-developed algorithm that reveals the control correlations between the nodes in the graph while requiring considerably less computational resources [@zhang_input_2016]. 
Using this algorithm, we are able to identify species that are possible control inputs—those that belong to the minimum driver-node set in at least one of the possible control configurations. 
Here, we extend this algorithm such that it is possible to calculate a highly accurate approximation of the control capacity $\phi$ of every species in the network (Supporting Information Section \@ref(S-input-graph)). 
In the networks that contained reciprocal links (because there was no asymmetry in the dependences of a species pair), we averaged a species' control capacity $\phi$ across every possible "non-reciprocal" version of the network (Supporting Information Section \@ref(S-reciprocal-links)). 

\R{R2-one-lumped-model-a}We then examined how species-level properties were related to control capacity using a set of candidate generalised linear models with binomial error structure. 
These models included five predictor variables that mirror the network-level predictors. 
First, the species' contribution to nestedness, which has been proposed as a key feature that promotes stability and robustness in mutualistic networks [@saavedra_strong_2011]. 
Second,\R{R2-species-strength-a} the species' strength (the sum of a species' visits), which quantifies the strength of a species' associations and is indirectly related to its abundance [@poisot_comparative_2012]. 
Third, the direction of asymmetry which quantifies the net balance in dependencies; that is, it indicates if a species affects other species more than what they affect it or not [@vazquez_species_2007]. 
Fourth, the species' degree in order to account for the intrinsic centrality of a species.
Finally, we included a categorical variable for the species' trophic level (plant or pollinator) and an interaction term between trophic level and the previous four variables. 
To facilitate comparison between predictors, degree and visitation strength were log-transformed and all four continuous variables were scaled to have a mean of zero and a standard deviation of one.
\R{R2-one-lumped-model-b}In these models, species from all networks were lumped together. 
\R{R2-random-effects}We initially included random effects to account for possible variation across communities, but we found that the variance explained by these random effects was zero, and therefore random effects were not included in further analyses. 
\R{R2-all-candidates}We then generated all possible candidate models.
To identify the models that were best supported by the data, we first determined the most parsimonious random structure using the AICc. 
The relative importance of variables was then assessed by looking at their effect sizes in the top-ranked models and the cumulative weight of the models in which they are present. 

In addition, we wanted to understand how a species' control capacity $\phi$ described above relates to metrics of keystoneness based on centrality. 
Specifically, in each network, we calculated the species' degree, betweenness, closeness centrality [@martin_gonzalez_centrality_2010], page rank [@mcdonald-madden_using_2016], and eigen centrality [@jordano_ecological_2006]. 
We then calculated the spearman correlation coefficient between control capacity and each of these centrality metrics. 

Our analysis revealed that some species have a control capacity $\phi = 1$. 
These species are critical to controlling their community because they are part of the minimum driver-node set in *every* control scenario. 
In other words, it is theoretically impossible to drive the state of the community to a desired state without directly managing the abundance of these species. 
We thus anticipate that these species have a disproportionally large impact on the community dynamics. 
To test this hypothesis, we identified these critical species in each of the networks and investigated whether they have a larger than average impact on the stable coexistence of species in the community. 
Within mutualistic networks, one useful measure of stable coexistence is called structural stability [@rohr_structural_2014]. 
Mathematically, the structural stability of a network represents the size of the parameter space (i.e., growth rates, carrying capacities, etc.) under which all species can sustain positive abundances [@saavedra_nested_2016]. 
The contribution of any given species *i* to stable coexistence can be estimated by calculating the structural stability of the community when the focal species *i* is removed. 
To allow comparison across communities, the structural stability values were scaled within each network to have a mean of zero and a standard deviation of one.
Given these species-specific estimates of structural stability, we then used a t-test to compare the contribution to stable coexistence of critical and non-critical species. 
More details about the calculation of structural stability can be found in the Supporting Information Section \@ref(S-structural-stability). 

## Testing assumptions
 
\R{testing-assumptions-line}Just like the centrality metrics, the information obtained by applying structural controllability depends on the ability of the network to accurately represent the ecological community. 
We thus tested the sensitivity of our approach to two fundamental assumptions. 
First, we tested that visitation is an appropriate proxy to infer interspecific effects by comparing the results obtained using visitation to two alternative metrics in a separate dataset that lacked invasive species [@ballantyne_constructing_2015]. 
Specifically, we also calculated the controllability (the size of the minimum driver node-set) and the control capacity of networks constructed using pollinator efficiency (which measures the pollen deposition of an interaction) and pollinator importance [which accounts for both pollen deposition and visitation and hence is regarded as a more accurate estimation of the pollination service received by plants; @neeman_framework_2010]. 
\R{R2-sentence-fragment} See Supporting Information Section \@ref(S-visitation-as-proxy) for more details. 

Second, because interspecific dependencies themselves depend on the network topology and consequently on the accurate sampling of interactions, we tested the robustness of structural controllability to the uncertainty involved with the sampling of interactions. 
Here, we compared the results obtained when using the full network and when randomly removing interactions from the weakest links in the network. 
This effectively removed the rare interactions from the networks (more details in the Supporting Information Section \@ref(S-undersampling)). 

# Results

## Controllability

```{r controllability-calculations}
drake::loadd(controllability, metadata, randomisations_test)
c_m <- controllability %>% 
  filter_networks_df(metadata)
```

The size of the minimum driver-node set relative to the number of species in each network $n_D$ ranged between $n_D = `r round(min(c_m$n_D), 2)`$ and $n_D = `r round(max(c_m$n_D), 2)`$ (median `r round(median(c_m$n_D), 2)`). 

## Differences between invaded and uninvaded networks

We found that the relative size of the minimum driver-node set of invaded communities was not significantly different from that of communities that have not been invaded (Figure \@ref(fig:fig-emp-controllability)a). 
In contrast, there was a large negative relationship between $n_D$ and the network asymmetry (Figure \@ref(fig:fig-emp-controllability)b).
Furthermore, there were also negative, albeit weaker, relationships between $n_D$ and connectance, nestedness and species richness (Table  \@ref(S-tab:tab-controllability-model-results)). 
The relative size of the minimum driver-node set $n_D$ of empirical networks did not differ from that of a null model that roughly preserved the degree distribution and fully preserved the network connectance ($p = `r sprintf('\\num{%s}', format(randomisations_test$interactions$p.value, digits = 2))`$; Figure \@ref(fig:fig-emp-controllability)c). 
However, empirical networks had a larger $n_D$ than null models that preserved the interactions but shuffled the direction of control of the empirical network ($p = `r sprintf('\\num{%s}', format(randomisations_test$directions$p.value, digits = 2))`$). 

```{r fig-emp-controllability, fig.width=fig_sizes()[[2]], fig.height=fig_sizes()[[1]]/2, fig.cap="Drivers of network controllability. (a) Probability density of the relative size of the minimum driver-node set $n_D$ in the invaded (light) and uninvaded (dark) empirical networks. (b) Relationship between the asymmetry plant/pollinator richness and $n_D$. (c) Probability density of the difference between the relative size of the minimum driver-node set of random networks and that of empirical networks. We randomised either the species visitation patterns (light line) or randomised the direction of control between a species pair (dark line). The vertical dashed lines in (a) and (c) indicate the median values of the distributions."}
drake::loadd(fig_emp_controllability)
fig_emp_controllability %>%
  purrr::map(function(x) x + theme(plot.margin = grid::unit(c(0.5, 1.5, 0.5, 1.5), "mm"))) %>% {
    cowplot::plot_grid(plotlist = ., 
                     nrow = 1, 
                     align = "h")
  }
  
```

```{r cirtical-species-descriptive}
drake::loadd(sl_characteristics)
crit <- sl_characteristics %>% 
  filter_networks_df(metadata) %>%
  dplyr::group_by(net_name) %>%
  dplyr::summarise(n_crit = sum(control_capacity == 1), 
                   n_sp = n()) %>%
  dplyr::mutate(p_crit = n_crit/n_sp)

pcrit_ran <- range(crit$p_crit)
ncrit_ran <- range(crit$n_crit)
pcrit_med <- median(crit$p_crit)
```

## Species' roles

Species varied widely in their control capacity (Figure \@ref(fig:fig-species-level)). 
Pollinators had, in average, larger control capacities than plants. 
That said, almost no pollinator was critical for network control, (where a species is critical for control if it has control capacity \(\phi_i = 1\)). 
Plants had a multimodal distribution of control capacity with maxima at both extremes of the distribution (Figure \@ref(fig:fig-species-level)a). 
Intriguingly, every invasive species was critical for network control in each of their communities.
The species-level models identified a positive relationship between control capacity \(\phi\) and a species' contribution to nestedness, visitation strength, and the asymmetry of its dependences (Table \@ref(tab:tab-model-selection-table); Figure \@ref(fig:fig-species-partial); Table \@ref(S-tab:tab-model-output-species-level)). 
Comparatively, species' degree was only weakly associated with control capacity (Table \@ref(S-tab:tab-var-importance)). 
In fact, many species with a low degree, especially pollinators, exhibited a large control capacity in their communities (Figure \@ref(S-fig:fig-species-models-degree)a). 

```{r correlation-calculations}
drake::loadd(sl_char_corr)
correlations <- sl_char_corr %>% 
  extract2("mean") %>%
  as.data.frame() %>%
  tibble::rownames_to_column() %>%
  dplyr::filter(!rowname %in% c("control_capacity", "superior"))
```

Species' control capacity $\phi$ was only weakly correlated with commonly-used centrality metrics. 
The Spearman correlation between these ranged between `r round(min(correlations$control_capacity), 2)` (with betweeness-centrality) and `r round(max(correlations$control_capacity), 2)` (with eigen-centrality), see Figure \@ref(S-fig:fig-correlogram)a. 
The correlation coefficient with degree was `r round(correlations[correlations$rowname == "degree", ]$control_capacity, 2)`, however most species with high degree also tended to attain a high control capacity (Figure \@ref(S-fig:fig-species-models-degree)a).

```{r tab-model-selection-table}
drake::loadd(species_model_cc)

cc_table <- MuMIn::model.sel(species_model_cc$fixed) %>%
  dplyr::filter(weight > 0.01)

dplyr::bind_rows(cc_table) %>%
  dplyr::select(-logLik, - AICc) %>%
  set_names(., pretty_term_names(colnames(.), "short")) %>%
  knitr::kable("latex", 
               # col.names = pretty_term_names(colnames(.), "short"),
               booktabs = T,
               caption = "Selection table of the binomial generalised linear models of species' control capacity, $\\phi$. Only models with a weight larger or equal to 0.01 are shown.", 
               row.names = F, 
               digits = 2, 
               escape = F) %>%
  kableExtra::add_header_above(c("model terms" = 10, " " = 3), escape = F) %>%
  kableExtra::kable_styling(font_size = 8) %>%
  kableExtra::footnote(general = "intercept (int), degree ($k$), trophic level ($l$), asymmetry ($a$), contribution to nestedness ($n$), visitation strength ($s$).", 
                       general_title = "Terms: ", 
                       footnote_as_chunk = TRUE, 
                       threeparttable = TRUE, 
                       escape = F)
```

```{r fig-species-level, fig.width=fig_sizes()[[2]]*2/3, fig.height=fig_sizes()[[1]]/2, fig.cap="Probability density of the control capacity $\\phi$ of (a) plants and (b) pollinators across all networks. The control capacity of all invasive species is $\\phi = 1$ and is depicted with solid circles."}
drake::loadd(fig_control_capacity)
fig_control_capacity[[2]] <- fig_control_capacity[[2]] +
  theme(axis.title.y = element_blank(),
        axis.text.y = element_blank())

fig_control_capacity %>%
    cowplot::plot_grid(plotlist = ., rel_widths = c(1.21,1), align = "h")
```

```{r fig-species-partial, fig.width=fig_sizes()[[2]], fig.height=fig_sizes()[[1]]/2, fig.cap= "Partial-residual plots for the independent variables: (a) contribution to nestedness, (b) visitation strength, (c) asymmetry of dependences, and (d) degree. Partial-residual plots show the relationship between control capacity and each of the independent variables while acccounting for all other remaining variables. Ploted values correpond to the predictions of the weighted average of the models shown in Table \\@ref(tab:tab-model-selection-table)."}
drake::loadd(fig_species_partial)
suppressWarnings({
  fig_species_partial %>%
  purrr::map_at(2:4, function(x) x  + theme(axis.title.y = element_blank(),
                                            axis.text.y = element_blank())) %>%
    cowplot::plot_grid(plotlist = ., 
                       align = "h", nrow = 1, 
                       rel_widths = c(1.25, 1, 1,1))
})

```

```{r critical-species-test}
drake::loadd(critical_sp_df)
crit_test <- critical_sp_df  %$%
    t.test(feasibility ~ critical, 
           alternative = "less", 
           conf.int = T)
```

Finally, we found that critical species have a particularly large impact on species coexistence when compared to non-critical species.
Indeed, the structural stability of the networks where critical species were removed was considerably lower to those in were non-critical species were removed ($p = `r sprintf('\\num{%s}', format(crit_test$p.value, digits = 2))`$; Figure \@ref(fig:fig-structural-stability); Supporting Information \@ref(S-structural-stability)). 

```{r fig-structural-stability, fig.width=fig_sizes()[[1]], fig.height=fig_sizes()[[1]]/2, fig.cap="Probability density of the structural stability of the communities after a single focal species is removed. Mathematically, the structural stability of a network represents the size of the parameter space (i.e., growth rates, carrying capacities, etc.) under which all species can sustain positive abundances. The structural stability of communities in which critical species have been removed (darker line) is considerably smaller than that of communities in which non-critical species have been removed. This indicates that critical species contribute more to the stable coexistence of their communities. To allow comparison across communities, the structural stability values were scaled within each network to have a mean of zero and a standard deviation of one. Here, we assume values of the mutualistic trade-off and mean interspecific competition of $\\delta = 0$ and $\\rho = 0.01$ respectively [@saavedra_nested_2016]. However, the choice of these parameters does not affect the results (Supporting Information \\@ref(S-structural-stability))."}
drake::loadd(fig_structural_stability)
fig_structural_stability[[1]]
```

## Testing assumptions

\R{testing-assumptions-results-line} We found that using visitation as a proxy for the strength of species' interactions leads to similar results than those obtained using pollinator importance [regarded as an accurate measure of the pollination service to plants; Supporting Information Section \@ref(S-visitation-as-proxy); @neeman_framework_2010]. 
Importantly, we also found that structural stability is robust to incomplete sampling of interactions. 
Indeed, we found strong agreement between results obtained using the complete empirical networks and those obtained by randomly removing the weakest interactions (Supporting Information Section \@ref(S-undersampling)). 
Despite removing rare interactions and species, the relative size of the minimum driver-node set, the superior species, and the relative rankings of control capacity were generally maintained. Of particular note, we found that critical species in the full network were also critical in the vast majority of rarefied networks. 

# Discussion

Our main goal was to understand the role that species play in both modifying the abundance of the species they interact with and the state of the community as a whole. 
To achieve that goal we applied *structural controllability*, a field at the intersection between control and complex theory that allowed us to obtain two key pieces of information: the *controllability* of a network and a species' *control capacity* (Table \@ref(tab:tab-glossary)). 
We found that the controllability of a network does not depend on its invasion status and that the species that are critical to altering the state of the community are also the ones that most sustain the stable coexistence of species in their communities.
  
Our results indicate that fully controlling ecological networks might currently be out of reach for all but the smallest communities [@motter_networkcontrology_2015]. 
Indeed, the median size of the relative minimum driver-node set in our dataset was $n_D = `r round(median(c_m$n_D),2)`$, a high value when compared to other complex systems in which controllability has been investigated (the lower $n_D$ the more controllable the community). 
For instance, only gene regulation networks appear to achieve similar levels of controllability while most social, power transmission, Internet, neuronal, and even metabolic networks seem to be "easier" to control ($0.1 < n_D < 0.35$) [@liu_controllability_2011]. 
Structural controllability provides solid theoretical rationale for the many difficulties encountered in the management and restoration of natural communities [@woodford_confronting_2016]. 
Nevertheless, structural controllability might be helpful at identifying communities in which changes in the ecological state are more likely to occur.

The differences between the controllability across networks are likely to arise from differences in their structure rather than their invasion status. 
Specifically, when controlling for network structure, we found no difference between the controllability of invaded and uninvaded networks. 
Instead controllability is almost completely constrained by the patterns of species richness at each trophic guild and their degree distributions [@melian_complex_2002; @bluthgen_specialization_2007]. 
These two factors are particularly relevant because they govern the asymmetric nature of mutual dependences, which themselves provide the foundation of structure and stability in mutualistic networks [@bascompte_asymmetric_2006; @memmott_tolerance_2004; @astegiano_robustness_2015]. 

Accordingly, our results suggest that structural controllability is closely related to the dynamic persistence of an ecological community based on two lines of evidence. 
First, we found a comparatively small but thought-provoking negative relationship between the controllability of a network and its nestedness. 
Previous studies indicate that nestedness promotes species coexistence and confers robustness to extinction [@bastolla_architecture_2009; @memmott_tolerance_2004] even at the expense of the dynamic stability of the mutualistic community [@saavedra_nested_2016]. 
These observations are in agreement with our results, as we would expect the dynamic stability of a community to be correlated to the difficulty to control it. 
Second, species' control capacity was strongly correlated to their contribution to nestedness and critical species had the largest impact to the stable coexistence of species in their communities. 
Therefore, species that play a key role at determining the state of the community might also be more key to "maintain the organization and diversity of their ecological communities", one of the hallmarks of keystone species [@mills_keystone-species_1993].

When controlling for a \R{R2-species-strength-b}species' visitation strength (the sum of a species' visits), which is indirectly a proxy of its abundance, and the net balance of its dependencies, we found that control capacity could not be easily predicted by species' degree or other metrics of centrality.
For instance, some species with a low degree achieved the maximum control capacity and were critical for control in their communities. 
At first glance, our findings challenge numerous studies that highlight the role that central species play in the dynamics of their communities and their utility at predicting species extinctions [@jordan_keystone_2009]. 
However, further inspection shows that our results do not contradict these findings; most species with a large degree also have a large control capacity and all of them were classified as superior nodes which corroborates the utility of classic centrality metrics. 
Putting these observations together, our results therefore take previous findings one step further and suggest that centrality might paint an incomplete picture of the relevance of species.

\R{management-implications}Other conceptual differences between structural controllability and centrality metrics provide three key insights into the conservation of ecological networks. 
\R{R2-structural-controllability} First, structural controllability emphasizes that the effect a species has on the abundance of other species is not independent of the effects of those other species in their community. 
The rankings provided by centrality metrics and other heuristics fail to account for the collective influence of several species at once. 
Second, it demonstrates that to ensure the persistence of a community it is often necessary to consider the abundances of more than a single species, even when full control is infeasible or undesired (for example `r round(sum(crit$n_crit > 1)/nrow(crit)*100)`% of our communities contained more than one critical species). 
Third, structural controllability explicitly acknowledges the existence of multiple management strategies and some will be better than others depending on the context.
Approaches to prioritise species for conservation and reintroduction based on traits or centrality are still useful and are likely to overlap with species' control capacity\R{extra-references-1} [@pires_friendship_2017; @devoto_understanding_2012]. 
Stepping back, our results also provide support to the idea that management decisions should not be based on a single technique but indicate that focusing on ecosystem processes and interactions may be more effective than traditional ranking-based approaches \R{extra-references-2} [@harvey_bridging_2017]. 

Our choice of studying invaded/uninvaded networks was based on a desire to contrast the extensive empirical evidence of the role of invasive plants with our theoretical results. 
We found that invasive plants were always critical for network control and as such our results were in line with our expectations. 
Invasive plants have been previously found to exacerbate the asymmetries in their communities [@aizen_invasive_2008; @bartomeus_contrasting_2008; @henriksson_strong_2016] \R{R2-central-in-their-communities}and to attain high centrality in their communities [@vila_invasive_2009; @palacio_generalist_2016]. 
\R{R2-inherrently-different} We found that it is not that invasive plants have some different mechanism for influencing the community compared to their native counterparts [@emer_species_2016; @stouffer_how_2014]. 
Both native species and invasive plants tended to attain a high control capacity if they were important to network persistence, were abundant, and depended little on other species. 
Furthermore, our observation that changes in the abundance of invasive plants (and presumably all critical species) are crucial to modify the state of the community agrees with recent evidence showing that ecosystem restoration focused on the eradication of invasive plants can have transformative desirable effects in plant-pollinator communities\R{extra-references-3} [@kaiser-bunbury_ecosystem_2017]. 
However, our results also suggest that removals must be exercised with caution. 
Not only it is hard to predict the direction in which the system will change, but we also show that critical species can underpin the coexistence of species and therefore some communities may be acutely vulnerable to their eradication [@traveset_invaders_2013; @albrecht_consequences_2014].

Structural controllability assumes that the networks can be approximated using linear functional responses [@liu_control_2016]. 
The ramifications of this assumption imply that, while structural controllability is useful to identify species that are relevant for network control, it cannot be used to design the *exact* interventions that should be applied to these species in order to achieve a desired state. 
In an ideal scenario, we would completely incorporate the species' dynamics into the controllability analysis [@cornelius_realistic_2013]; the reality is that such information is rarely available in most ecological scenarios. 
\R{data-requirements}In contrast, structural controllability only requires a quantitative approximation of the network's interactions to gain valuable insight from the community.
Furthermore, while the relationship between centrality and keystoneness is based on an intuitive understanding of what a keystone species is, the assumptions of structural controllability are explicit and the estimation of a species' importance arises from a mechanistic understanding of the population dynamics between species. 
\R{R2-marginally-affected} By accounting for network dynamics (even if in a simple way), structural stability incorporates more ecological realism, especially in the extreme scenario in which the structure of interactions within the community only marginally affects the community's state.

# Conclusions

Here we show that structural controllability can be applied in an ecological setting to gain insight into the stability of a community and the role that species play in modifying the abundance of other species and ultimately the state of the community. 
These characteristics make structural stability an ideal framework to evaluate the effects of invasions and other types of perturbations. 
Importantly, structural controllability can be used to identify critical species in the community that promote biodiversity and underpin the stable coexistence of species in their community.
Collectively, critical species dominate the state of their community and therefore are likely to be highly relevant for ecosystem management and conservation. 
While useful, centrality metrics, which have often been used as a proxy for keystoneness, fail to identify some of these species, highlighting their limitations when we fully embrace the notion that ecological communities are dynamical systems.
@paine_note_1969 showed nearly 50 years ago that one single species can dominate the state of its community. 
Structural controllability suggests that this situation might be the exception rather than the rule. 
We see our study as a starting point to study the controllability of ecological and socio-ecological systems where many exciting questions lie ahead.

# Acknowledgements

The authors thank Jane Memmott and co-authors, and everyone that has made their data available to us, Takeuki Uno for the insight provided to find the set of all maximum matching algorithms, and Jason Tylianakis, Bernat Bramon Mora, Guadalupe Peralta, Rogini Runghen, Michelle Marraffini, Mark Herse, Warwick Allen, Matthew Hutchinson, and Marilia Gaiarsa for feedback and valuable discussions. 
EFC acknowledges the support from the University of Canterbury Doctoral Scholarship, the University of Canterbury Meadow Mushrooms Postgraduate Scholarship, a New Zealand International Doctoral Research Scholarship, and a travel grant from the European Space Agency. 
DBS acknowledges the support of a Marsden Fast-Start grant and a Rutherford Discovery Fellowship, administered by the Royal Society Te Aparangi.

# Author contributions

DBS conceived the idea; all authors contributed to the development of the theoretical framework. EFC performed all analysis. EFC and DBS wrote the manuscript. All authors contributed to its revision.

# Data accessibility

All data used in this manuscript have already been published by @lopezaraizamikel_impact_2007, @bartomeus_contrasting_2008, and @ballantyne_constructing_2015 The reader should refer to the original sources to access the data.

# References
