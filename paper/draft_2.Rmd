---
title: "Biotic invasions reduce the manageability of pollination networks"
classoption: a4paper
csl: ecology-letters.csl
output:
  pdf_document:
    fig_crop: no
  html_document: default
  word_document: default
header-includes:
- \usepackage{setspace}
- \usepackage{float}
documentclass: artikel1
bibliography: references.bib
---

\doublespacing

```{r libraries, echo = F, include = F}
library(igraph)
library(magrittr)
library(dplyr)
library(latex2exp)
library(ggplot2)

"../code/functions" %>% 
	list.files(full.names = T) %>%
	plyr::l_ply(source)

"../code/plotting_functions" %>% 
	list.files(full.names = T) %>%
	plyr::l_ply(source)
  
```

```{r load data, include = F}
net <- "../data/processed/networks" %>%
	read_networks()
meta <- readr::read_csv("../data/ntw_info.csv") %>% dplyr::tbl_df() %>%
	dplyr::rename(count = method)
n_driver <- readRDS("../data/processed/n_driver.rds")
manag_models <- readRDS("../data/processed/models_manageability.rds")
src_bi_w <- readRDS("../data/processed/manageability_bi_vs_weight.rds")
```

```{r plot theme, echo = FALSE, warning = F, message = F}
fer_theme <- theme_bw() +
	theme(text = element_text(family = "Times"),
	      title = element_text(size = 7.5, hjust = 0),
	      legend.title = element_text(size = 9),
	      legend.text = element_text(size = 8),
				axis.text = element_text(size = 8),
				axis.title = element_text(size = 9, hjust = 0.5), 
				strip.text = element_text(size = 9, hjust = 0), 
				strip.background = element_blank(),
				plot.margin = grid::unit(c(5, 0, 2, 0), "mm"))
```

```{r example networks, include = F, message = F, warning = F, }

sp_names_fancy <- c(TeX("$p_1$"), TeX("$p_2$"), TeX("$p_3$"), TeX("$a_1$"), TeX("$a_2$"))
sp_names_fancy_b <- c(TeX("$\\mathbf{p_1}$"), TeX("$\\mathbf{p_2}$"), TeX("$\\mathbf{p_3}$"), TeX("$\\mathbf{a_1}$"), TeX("$\\mathbf{a_2}$"))

sp_names <- c("p1", "p2", "p3", "a1", "a2")

adj_matrix <- c(0,0,0,1,0,
								0,0,0,2,5,
								0,0,0,0,0,
								0,0,1,0,0,
								0,0,1,0,0) %>%
	matrix(nrow = 5, byrow = T)

example_net <- adj_matrix %>% 
	graph_from_adjacency_matrix(mode = "undirected", weighted = TRUE) 
igraph::V(example_net)$type <- c(F, F, F, T, T)
igraph::V(example_net)$name <- sp_names

base_net <- example_net
bi_net <- example_net %>%
	keep_largest_component() %>%
	bipartite_digraph(type = "z-bi", weight.type = "assymetry") 
as_net <- example_net %>%
	keep_largest_component() %>%
	bipartite_digraph(type = "weight", weight.type = "asymmetry")

fam <- "Helvetica"
# layout is based on the bidirectional network
set.seed(1)

lay <- bi_net %>%
	layout_nicely()
v_c <- "white"
l_c <- "black"
l_s <- 0.9
ma <- c(0,0,0,0)
label_pos_x <- -1
label_pos_y <- 1

pal <- RColorBrewer::brewer.pal(5, "PuOr")
```

# Introduction

Complex systems are characterised by relationships in which the whole is often greater than the sum of its parts [@Jorgensen1998; @Levin1999; @Montoya2006].
Within community ecology, a complex systems approach has led to the development of a variety of analytical and simulation tools with which to understand, for example, the role of species when embedded in an intricate network of interactions [@Pascual2005; @Bascompte2009; @Stouffer2012]. 
The inherent complexity of nature, however, has hindered—or at least greatly complicated—our ability to find management solutions to the many problems ecological communities face. 
To overcome this obstacle, we require a framework that allows us to explain, predict, and manage ecological communities, particularly when they are confronted with perturbations [@Sole2001; @Green2005].
Moreover, such a framework needs to be able to account for their complex structure, and the dynamics that determine the state of each species, and the community as a whole. 

Among the various possibilities, control theory appears to be a strong candidate as it is designed to deal with determining and supervising the behaviour of general dynamical systems, and is well equipped to deal with the many feedbacks present in ecological communities [@Liu2015]. 
Research in the field has established a strong link between the structure of complex networks and their controllability, while also demonstrating that it is in principle possible to alter a whole ecological community's composition by modifying the abundances of only a few species [@Liu2011; @Cornelius2013; @Ruths2014].
Applications of control theory to ecological networks can also take into account the extent to which changes in the abundances of one species may ripple through the community [@Cornelius2013].
Therefore, control theory could provide an indication of which species are most relevant from a structural and dynamic perspective, a particularly important feature given that these species should underpin informed attempts to both alter or maintain the ecosystem state.

Despite these advances, practical challenges to the conservation of interaction networks persist [@Tylianakis2010], and the link between the structure of complex networks and our ability to manage and conserve them is still ambiguous [@Kaiser-Bunbury2015].
To complicate things further, biotic invasions—a major driver of global change—can induce dramatic changes in the patterns of interactions that determine the structure of ecological networks [@Baxter2004; @Tylianakis2008; @Ehrenfeld2010a]. 
Although understanding how differences in network structure before and after the invasion impact our ability to manage them presents a double challenge, it is a critical first step towards a fully informed recovery. 
Despite the apparent overlap, a control-theoretic perspective has not been widely adopted in an invasion context. 
This is perhaps because of a lack of appropriate methodological tools that can account for the observed variation in the strength of interspecific effects that are characteristic of ecological networks [@Liu2011; @Isbell2013].

To bridge this gap, we develop methods to apply previous theory on the control of complex systems into an ecological context and implement them using empirical data, while taking into account the quantitative differences that exist among species interactions.
Specifically, we use a set of ten pairs of uninvaded and invaded plant-pollinator communities to investigate the link between invasion, network structure and ecological management. 
We ask two questions framed in the context of a plant invasion.
First, on the basis of the complexities involved with invasive species erradication and ecosystem restoration [@Woodford2016], we ask whether invaded networks have lower levels of manageability than their uninvaded counterparts; that is, whether they require a greater proportion of species to be managed to achieve the same level of control. 
Second, we ask whether some species are more important than others at driving the population dynamics of the community and which factors determine this importance. 
We focus on these particular applications for a variety of reasons. 
First, biotic invasions are known to produce tractable changes in the structure of ecological networks, and these changes can be particularly pronounced in mutualistic networks between plants and pollinators where biotic invasions have been shown to modify the strength of species interactions and the degree of network nestedness and connectivity [@Olesen2002; @Aizen2008; @Bartomeus2008; @Vila2009; @Traveset2013]. 
Second, plant-pollinator networks provide an ideal framework to answer these questions. 
On the one hand, community networks that quantify relative levels of interaction are readily available. 
On the other, the bipartite nature of pollination networks makes it possible to simplify assumptions of how these interactions translate into interspecific effects. 

# Methods

## Theoretical framework

At the core of control theory of complex networks is the idea that the state of a node depends on the state of the nodes it interacts with, and the particular form of this dependency is determined both by the dynamic relationship among interacting nodes as well as the structure of the links in the network. 
A complex network can usually be simplified as a linear system of the form $\dot{x} = Ax + Bu(t)$, where the change over time of its state ($\dot{x}$) depends on its current state *x*, an external time-varying input *u(t)*, and the matrices *A* and *B*, which encapsulate information about the network structure and how the network responds to the external input, respectively.
Previous research has shown that such a system is controllable if there exists a minimum number of nodes in the network ($D \geq 0$) to which is possible to apply an external control signal that propagates trough the network to in turn drive the state of every other node in the network to a particular configuration [@Kalman1963; @Liu2011].
Conveniently, the information necessary to determine whether a network is controllable, and the number of driver nodes *D*, is fully contained in the network structure [@Liu2011; @Motter2015] 

Strictly speaking, the network structure tells us whether a linear approximation of the system is controllable or not, but it provides limited information about the characteristics of the control signal or the feasibility of its implementation [@Motter2015].
Despite this limitation, structural controllability provides important information about our ability to control a system without requiring full and precise knowledge of the dynamical relationships among nodes.
This means that structural controllability can be applied to a wide range of readily available network representations of ecological communities. 
Moreover, when quantitative data about species interactions is available, we show how some of the limitations of structural controllability can be overcome by incorporating the role of dynamical relationships without being overly dependent on the particular choices about how dynamics are modelled.

### Manageability

The number of driver nodes *D* not only determines whether a network is controllable but can also provide a structural indication of how difficult its control might be.
This is because systems that require a large number of external input signals are intuitively more difficult or costly to control.
In an ecological context, external signals that modify the state of a node (this is a species' population) can be thought of as management interventions.
We, therefore, use the density of driver nodes $n_D = \frac{D}{S},$ as an index of the manageability of an ecological community, where *S* is the total number of species.
From this perspective, the manageability of an ecological community can be understood in the context of how difficult is to modify the abundances of species in the community using external interventions—a common theme in ecosystem management, conservation, and restoration.

It has been recently shown that calculating *D* is equivalent to finding a maximum matching in the network [@Liu2011].
In a directed network, a matching is a subset of links in which no two of them share a common starting or ending node (Figure 1).
A given matching has *maximal cardinality* if the number of matched links (also referred to as the *matching size*) is the largest possible.
A maximal cardinality matching is then called a *maximum matching* if the sum of the weights of the matched links (also referred to as matching weight) is again the largest possible [@West2001].
Note that this implies that for unweighted binary networks all maximal cardinality matchings are also maximum matchings.

Once we have the subset of links that constitute a matching, we can also classify the nodes in the network (Figure 1).
A node is said to be *matched* if it is at the end of a matched link and *unmatched* otherwise. 
A node is also said to be *superior* if it is at the start of a matched link (note that a node cannot be superior if it has no outgoing links).
Notably, these node categories help us to intuitively link a maximum matching back to the concept of network controllability as follows.
Each matched node can be controlled by the node that is pointing to it—its superior.
Unmatched nodes, on the other hand, are the driver nodes *D* because they have no superior in the network and must be directly controlled by an external input [@Liu2011].

```{r figure 1, echo = F, message = F, warning = F, fig.width = 6.2, fig.height = 1.8, results= "hide", fig.pos = "t", fig.cap = "**Matchings of a simple network**. We start with a network in which the direction of the links indicate the direction of control (a); that is, a link from *a~1~* to *p~1~*, for instance, indicates that the state of *p~1~* (density/abundances in an ecological context) is influenced by the state of *a~1~*. This network has two maximal cardinality matchings (b, c); this is, two configurations in which it would be possible to exert full control of the network. The three matched links (blue arrows) represent the possible control paths trough the network and provide an indication of the matched nodes (also in blue), which are controlled by superior nodes within the network (bold node labels). Unmatched nodes (in orange) are also called driver nodes because full network control requires external signals to be applied to them, and therefore, the manageability of the network can be inferred from the density of unmatched nodes *n~D~ = D/S = 2/5*. Out of the two maximal cardinality matchings (b, c) only one of them has maximum weight and therefore is a maximum matching (c); note that if the network were unweighted both maximal cardinality matchings would also be maximum matchings. Further examples can be found in the Supplemental Material SXX."}
layout(matrix(c(1,2,3,4, 4, 4), 2, 3, byrow = TRUE),
  	heights=c(8,1))
par( mar=c(0,0,0,0))

as_net %>% 
	plot(layout = lay, 
			 vertex.color = v_c, 
			 vertex.size = 30,
			 vertex.label = sp_names_fancy,
			 vertex.label.family = fam,
			 vertex.label.color = l_c,
			 edge.label = round(E(.)$weight,1), 
			 edge.label.family = fam,
			 edge.label.color = l_c,
			 edge.label.cex = l_s,
			 edge.curved = F,
			 edge.arrow.size = 0.5,
			 margin = ma)

text(label_pos_x, label_pos_y, "a)", adj = c(0,0))

as_mat <- as_net %>%
	digraph_bipartite() %>% 
	max_bipartite_match()

as_all_mat <- as_net %>%
	digraph_bipartite() %>%
	igraph::make_line_graph() %>%
	igraph::complementer() %>% 
	igraph::max_cliques(min = as_mat$matching_size) %>%
	rev()

text_pos_x <- 0.5
text_pos_y <- -0.7

base_as_net <- as_net
E(as_net)$weight <- round(E(as_net)$weight, 1)

1:length(as_all_mat) %>%
	plyr::l_ply(function(x){
		
		E(as_net)$matched <- 2
		E(as_net)$matched[as_all_mat[[x]]] <- 4
		
		igraph::V(as_net)$matched <- 2
		igraph::V(as_net)$matched[igraph::V(as_net)$name %in%
																ends(as_net, as_all_mat[[x]])[, 2]] <- 4
		
		igraph::V(as_net)$superior <- 1
		igraph::V(as_net)$superior[igraph::V(as_net)$name %in%
																ends(as_net, as_all_mat[[x]])[, 1]] <- 2
		
		names_fancy <- sp_names_fancy
		names_fancy[igraph::V(as_net)$name %in%
																ends(as_net, as_all_mat[[x]])[, 1]] <-
			sp_names_fancy_b[igraph::V(as_net)$name %in%
																ends(as_net, as_all_mat[[x]])[, 1]]
		
		matching_weight <- sum(E(as_net)$weight[as_all_mat[[x]]])
		
		as_net %>% 
			plot(layout = lay, 
					 vertex.size = 30,
					 vertex.label = names_fancy,
					 vertex.label.family = fam,
					 vertex.label.color = l_c,
					 vertex.label.cex = igraph::V(.)$superior * 0.1 + 0.9,
					 # vertex.shape = igraph::V(.)$vertex.shape,
					 vertex.color = pal[igraph::V(.)$matched],
					 edge.color = pal[E(.)$matched],
					 edge.label = NA, 
					 edge.width = E(.)$matched/2,
					 edge.label.family = fam,
					 edge.label.color = igraph::E(.)$matched,
					 edge.label.cex = l_s,
					 edge.curved = F,
					 edge.arrow.size = 0.5,
					 margin = ma) %>% 
			print()
		
		igraph::V(as_net)$name <- sp_names
		
		text(label_pos_x, label_pos_y, paste0(letters[1+x], ")"), adj = c(0,0))
		text(text_pos_x, text_pos_y, cex = 0.95,
				 paste0("D = ", length(igraph::V(as_net)) - as_mat$matching_size, "\n",
				 			 "matching size: ", as_mat$matching_size, "\n",
				 			 "matching weight: ", round(matching_weight, 1)))
})

as_net <- base_as_net

plot.new()
legend(0.16, 0.9, legend = c("unmatched link", "matched link"), horiz = TRUE,
			 lty = 1, 
			 col = pal[c(2, 4)],
			 lwd = 2, cex = 0.9, xjust=0.5, yjust=1, bty = "n")

legend(0.57, 0.9, legend = c("unmatched node", "matched node"), horiz = TRUE,
			 pch = 21, 
			 pt.bg = pal[c(2, 4)],
			 pt.cex = 2,
			 cex = 0.9, xjust=0.5, yjust=1, bty = "n")

legend(1-0.16 + 0.05, 0.9, legend = expression(paste(bold("(bold label)"), " ", "superior nodes")), horiz = TRUE,
			 cex = 0.9, xjust=0.5, yjust=1, bty = "n")

```

### Relative importance

While calculating *n~D~* provides an indication of the manageability of an ecological community, it does not provide information about the identity of the species that compose this set. 
This difference is rather important since maximum matchings are often not unique in a given network and different sets of species of size *~D~* could potentially be used to control the network [@Liu2011]. 
Ecologically, these distinctions are also relevant because management and conservation resources are limited and therefore ecological interventions should ideally be focused on the set of species that might provide the largest impact.
Consequently, species can be further characterised in terms of the frequency with which they exist on key paths leading through the network, which provides an indication of their relative importance in driving the state of the community. 

Specifically, in an unweighted network to approximate a species importance for network control it is possible compute all the maximum matchings and calculate the frequency at which each species is classified as a superior node.
Because our networks are weighted, we compute all maximal cardinality matchings and not just the maximum matchings. 
We do so because empirical interaction strengths are to some extent stochastic and depend on proximate factors such as sampling method and intensity [@Gibson2011], and therefore using only maximum matchings in empirical networks might be therefore too restrictive. 
Furthermore, we focus not only on driver/unmatched nodes, as is customary in the control literature, but also on superior nodes because realistically, from an ecological perspective, we are not yet able to aim for full control of the abundances of all species in the community.
Superior nodes, of which driver nodes are a subset, are important for the controllability of the network not just because they might require an external control signal but, essentially, because they are part of the chain that transmits the control signal to other species.

It is worth to note that, traditionally, structural controllability assumes unweighted links—they exist or not—and hence results are entirely based on topology.
However, it has been shown that using weighted links can reveal important ecological patterns and processes that might be undetectable in unweighted networks [@Scotti2007; @Tylianakis2007; @Vazquez2007; @Kaiser-Bunbury2010a].
By using the quantitative version of the maximum matching algorithm, we give priority to the species that participate in the pathways that potentially have the largest impact on the community; effectively incorporating, at least partially, the dynamics of the system.

## Empirical application

```{r network summaries, include = F}
lop <- filter(meta, study == "lopezaraiza") %>% mutate(size = n_pla + n_pol) %$% size %>% summary() 
bar <- filter(meta, study == "bartomeus") %>% mutate(size = n_pla + n_pol) %$% size %>% summary() 
```

Now we describe the application of the previously described framework to ten paired pollination networks constructed from previously published visitation data. 
Notably, each network pair was composed of a community invaded by a plant and a community "free" of the invasive species. 
Four network pairs were obtained from natural or semi-natural vegetation communities in the city of Bristol, UK [@Lopezaraiza-Mikel2007]. 
These networks are comprised by between `r lop[1]` and `r lop[6]` species (mean `r round(lop[4])`) and non-invaded plots were obtained by experimentally removing all the flowers of the invasive species *Impatients grandulifera*.
The six remaining network pairs were obtained from lower diversity Mediterranean shrublands in Cap de Creus National Park, Spain [@Bartomeus2008].
These networks are comprised by between `r bar[1]` and `r bar[6]` species (mean `r round(bar[4])`) and, contrastingly, uninvaded communities were obtained from plots that had not yet been colonised by either of the invasive species *Carpobrotus affine acinaciformis* or *Opuntia stricta*. 
Further details about the empirical networks can be found in the Supplementary Information XXX.

The structure of all studied networks was determined using visitation frequency which has been shown to be an appropriate surrogate for interspecific effects in pollination networks [@Vazquez2005; @Bascompte2006]. 
To examine whether this decision would influence our results, we also evaluated the effect of using pollinator efficiency or importance as alternative measures of species interactions in a different data set that lacked invasive species [@NeEman2010; @Ballantyne2015], and we found quantitatively similar results for all of these options (Supplementary Information XXX).
Furthermore, because our approach depends to a large degree on the network topology, we evaluated the robustness of our results to undersampling.
The sensitivity analysis indicated that the proposed methods can be applied even in the absence of complete sampling (Supplementary Information XXX).

### Manageability

```{r component_lost, echo = F, eval = T}
a <- net %>%
	lapply(igraph::E) %>%
	lapply(length)

b <- net %>%
	lapply(keep_largest_component) %>%
	lapply(igraph::E) %>%
	lapply(length)

int_lost <- ((mapply(magrittr::subtract, a, b) / unlist(a)) * 100) %>% mean() %>% round(1)

a <- net %>%
	lapply(igraph::V) %>%
	lapply(length)

b <- net %>%
	lapply(keep_largest_component) %>%
	lapply(igraph::V) %>%
	lapply(length)

sp_lost <- ((mapply(magrittr::subtract, a, b) / unlist(a)) * 100) %>% mean() %>% round(1)
```

Given the different networks, we began by quantifying their manageability.
To do so, we calculated the maximum matching of the corresponding pollination network and determined the minimum proportion of species that need directed interventions to fully control the species abundances in the community. 
To simplify the analysis, we only considered the largest component in a network if it had more than one (two species are in different components if there exists no path between them and are hence independent of each other in terms of network control). 
Smaller components were present in eleven out of the twenty networks and were typically composed of just one plant and one pollinator. 
Their removal represented an average loss of `r sp_lost`% of the species and `r int_lost`% of the interactions.

#### Weighting & directing links

Recall that the aforementioned maximum matching algorithm requires a directed network in which a link between species *i* and *j* pointing to species *j* indicates that the abundance of *j* can be affected by the abundance of *i*.
This implies that we need first to identify a directionality for the links between species that is consistent with the dynamics of the community. 
In some ecological networks, establishing the directionality is relatively straightforward, for example when links represent biomass transfer or energy flow. 
Interspecific effects in pollination networks, however, are not strictly directed since the benefit is mutual between interacting species. 
Nevertheless, the relative extent to which a given pair of interacting species affect each other can be quantified by the magnitude of the mutual dependence [@Bascompte2006]. 
The dependency of plant *i* on pollinator *j*, *d~ij~*, is the proportion of the visits coming from pollinator *j* compared to all pollinator visits to plant *i*. 
Likewise, the dependency of pollinator *j* on plant *i*, *d~ji~*, is the ratio of the visits by pollinator *j* to plant *i* and all visits of pollinator *j*.
As the dependencies are not symmetric, its use generates a weighted bipartite network in which all interacting pairs are connected by two directed links (Figure 2b). 

```{r figure 2, echo = F, fig.width = 6.2, fig.height = 1.6, message = F, warning = F, fig.pos = "T", fig.cap = "**Different ways to depict quantitative mutualistic networks**. (a) Pollination networks are typically described by the number of visits between each plant and animal species. (b) Given visitation data, the mutual dependencies between interacting species are calculated directly based on the relative visitation frequencies. (c) The relative differences of dependencies—the interaction asymmetry—then provide a means to identify the dominant direction of the interspecific effects."}

par(mfrow=c(1,3), mar=c(0,0,0,0))

base_net %>%
	plot(layout = lay, 
			 vertex.color = v_c, 
			 vertex.size = 30,
			 vertex.label = sp_names_fancy,
			 vertex.label.family = fam,
			 vertex.label.color = l_c,
			 edge.label = E(.)$weight, 
			 edge.label.family = fam,
			 edge.label.color = l_c,
			 edge.label.cex = l_s,
			 edge.curved = F,
			 frame = F,
			 margin = ma)
text(label_pos_x, label_pos_y, "a)", adj = c(0,0))

bi_net %>% 
	plot(layout = lay, 
			 vertex.color = v_c, 
			 vertex.size = 30,
			 vertex.label = sp_names_fancy,
			 vertex.label.family = fam,
			 vertex.label.color = l_c,
			 edge.label = round(E(.)$weight,1), 
			 edge.label.family = fam,
			 edge.label.color = l_c,
			 edge.label.cex = l_s,
			 edge.curved = T,
			 edge.arrow.size = 0.5,
			 margin = ma)
text(label_pos_x, label_pos_y, "b)", adj = c(0,0))

as_net %>% 
	plot(layout = lay, 
			 vertex.color = v_c, 
			 vertex.size = 30,
			 vertex.label = sp_names_fancy,
			 vertex.label.family = fam,
			 vertex.label.color = l_c,
			 edge.label = round(E(.)$weight,1), 
			 edge.label.family = fam,
			 edge.label.color = l_c,
			 edge.label.cex = l_s,
			 edge.curved = F,
			 edge.arrow.size = 0.5,
			 margin = ma)
text(label_pos_x, label_pos_y, "c)", adj = c(0,0))

```

Given the respective dependences, the extent to which a species $i$ affects species *j* relative to the extent to which *j* affects *i* can be summarised by the interaction asymmetry given by $$a(i,j) = \frac{\left | d_{ij}-d_{ji} \right |}{max\left ( d_{ij}, d_{ji} \right )}.$$
Mutual dependencies have previously been shown to be highly asymmetric in natural communities [@Bascompte2006]; in other words, if a plant species is largely dependent on a pollinator species, then that pollinator tends to depend rather weakly on the plant (or vice versa). 
This suggests that it may be possible to relax the assumption of bidirectional dependences further and simplify the network such that interacting species are connected by only one directed link when mutual dependencies are asymmetric (Figure 2c). 
Changing to unidirectional interactions determined by the observed direction of asymmetry, as a surrogate of bidirectional mutual dependences does not alter the relative *n~D~* of different networks (Supplementary Information XXX). 
Moreover, it confers an additional advantage for our purposes since it dramatically reduces the number of links in the network. 
This translates into a substantial reduction of the time and memory required for the computation of all possible maximum matchings in a network, particularly for large networks (see "Relative importance" subsection below).

#### Computational considerations

Finding the maximum matchings, especially in large, directed, and highly connected networks can be an expensive operation.
Although other less computationally expensive approaches to characterise the control profile of complex networks that are based on heuristics do exist [@Ruths2014], we found them to be extremely sensitive to assumptions regarding the direction of control (Supplementary Materials Section 2).
Our strategy, instead, is to adopt an alternative bipartite representation of the directed network in which the two levels indicate the outgoing and incoming links to each node (Supplementary Section XXX). 
Once we had this alternative representation, then used the maximum bipartite matching algorithm implemented in `igraph` [@Csardi2006a].

#### Statistical analysis

Although understanding the variability of manageability across ecological networks is a useful result itself, we also wanted to test whether invasion status has an impact on the observed *n~D~*. 
We, therefore, used a set of generalised linear models (with binomial error structure) to investigate the effect of invasion status while also controlling for factors related to species richness, since one might naively expect to see a negative relationship between diversity and manageability [@Menge1995]. 
These covariates included the total number of species, plant richness, pollinators richness, the ratio of plants to pollinators richness, the link density (connectance), and the study site (as a two-level factor). 
We assessed competing models by comparing the Akaike Information Criterion corrected for small sample sizes (AICc), and report results for the most parsimonious model.

We next explored whether real networks differ in their architecture from random ones in a concerted way that affects manageability. 
Previous research indicates a direct link between a network's degree distribution and the number of nodes necessary to fully control it [@Liu2011], but the strength and applicability of this relationship have not been tested for in weighted ecological networks. 
We, therefore, compared the driver node density *n~D~* of the empirical networks to networks generated by a null model that maintained each species' strength (its total sum of visits) while allowing their degrees (its number of interactions) to vary. 
Randomisations were generated using vegan 2.3-3 [@Oksanen2016]. 
After generating the randomised networks, we then calculated the mutual dependences and interaction asymmetries of each and determined *n~D~*  using our maximum matching framework.
Finally, we calculated the average rank (akin to a p-value) of *n~D~* for each empirical network compared to the corresponding one of each set of 999 randomisations.

Beyond network structure, the dependency asymmetry plays a fundamental role in determining the direction of control in each two-species interaction and therefore has the potential to influence the network *n~D~* results above. 
We, therefore, performed an additional randomisation in which we kept the structure of network constant but randomised the direction of the interaction asymmetries. 
That is, we first calculated the asymmetries for each community and then shuffled the direction of the link between each pair of species. 
Similar as to the other null models, we calculated the average rank of the empirical *n~D~* when compared to that of the randomisations.

### Relative importance

Our second key question is related to how species differ in their importance for driving the population dynamics of the community. 
To quantify this importance we computed all maximal cardinality matchings in each network. 
We then calculated the frequency with which each species is deemed to be a superior and a driver node in the set of matchings that had a total weight greater or equal to 0.5 times the weight of the maximum matching. 
We selected this threshold as it provided a high agreement between networks quantified by visitation and pollination efficiency as well as between our weighting/directionality assumptions (mutual dependences and interaction asymmetries); however, the choice of this threshold had a negligible impact on the results (Supplementary Information XXX).

Although the species importance calculated from mutual dependences contains full information, even in sparse networks, like those studied here, the number of maximal matchings increases exponentially with the number of links and nodes in a network. 
Unfortunately, this means that the large number of links in the most diverse communities rendered the computation unfeasible when we used mutual dependencies. 
Taking this limitation into account, we compared the relative species ranks obtained when using asymmetries to those found when using mutual dependencies to test if they gave consistent results. 
The comparison was performed for eleven of the twenty networks (those for which the number of matchings was smaller than 4 x 10^10^), using a paired Spearman correlation test, a weighted correlation coefficient *r~w2~* [which gives more weight to higher ranks; @PintoDaCosta2015], and a Jaccard similarity of the driver species in both approaches. 
All three approaches identified a high similarity in relative ranks. 
Consequently, we focused on the results when using the asymmetries rather than mutual dependencies when further investigating the factors that determine species' relative importance since this also allows us to obtain results for all 20 networks.

#### Computational considerations

To compute all the maximum cardinality matchings we first generate the network's line graph—another representation in which nodes are the links of the original network and links represent common ending points [@West2001]. 
Then calculate the complement of this line graph, which generates a graph in which nodes are connected if and only if they are not connected in the line graph. 
Finally, all possible matchings of maximal size can be found by enumerating every clique (subgraphs in which all nodes are fully connected to each other) of maximum size in this complement graph [@Csardi2006a; @Gutin2013].
A graphical representation of this procedure can be found in Supplementary Information Fig XX.

#### Statistical analysis

We then asked the question of whether some species-level structural properties can predict our metrics of species importance—the frequency to which a species is a driver or a superior node.
We used a set of generalised linear mixed-effects models (with binomial error structure) with the relative frequencies as the response variables. 
As predictors in this model, we included measures of centrality (degree and eigen-centrality), which have been found to be strong predictors of importance in a coextinction context [@Memmott2004]; a measure related to network robustness (contribution to nestedness), as nestedness has been proposed as one of the key properties that promote stability in mutualistic networks [@Saavedra2011]; two measures of strength of association and dependence (visitation and dependency strength), as their distribution determines the extent of interspecific effects [@Bascompte2006].
In addition, we also included guild and invasive status as categorical fixed effects; although the importance of plants and pollinators or invasive and non-invasive species could respond differently to our structural metrics, our data set did not contain enough variation to include the corresponding interactions terms for these latter two predictors. 
All network metrics were calculated using the R package bipartite 2.06 [@Dormann2008]. 
We lastly allowed for variation between different communities by including the network identity as a random effect [@Bates2015]. 
Candidate models were compared using AICc and the relative importance of the explanatory variables was evaluated using the sum of Akaike weights over candidate models that accounted for 95% of the evidence [@Burnham2003; @Bates2015; @Barton2016]. 
Coefficient estimates were averaged following @Buckland1997a while confidence intervals were calculated following @Lukacs2010.

# Results

## Manageability

All of the networks studied had a driver node density *n~D~* between `r round(min(dplyr::filter(n_driver, type == "z-bi")$n_dr_p), digits = 2)` and `r round(max(dplyr::filter(n_driver, type == "z-bi")$n_dr_p), digits = 2)` (mean `r round(mean(dplyr::filter(n_driver, type == "z-bi")$n_dr_p), digits = 2)`) when we considered bidirectional links weighted by the mutual dependences. 
This was in strong agreement with the results obtained using the dependence asymmetry for which *n~D~* ranged between `r round(min(dplyr::filter(n_driver, type == "weight")$n_dr_p), digits = 2)` and `r round(max(dplyr::filter(n_driver, type == "weight")$n_dr_p), digits = 2)` (mean `r round(mean(dplyr::filter(n_driver, type == "weight")$n_dr_p), digits = 2)`; Spearman rank correlation `r round(src_bi_w$estimate, digits = 2)`, *p* `r fix_small_pvalue(src_bi_w$p.value)`). 
In addition, we found that invaded communities had less driver node density than uninvaded ones even when controlling for potential diversity effects (Figure 3), suggesting that. 
Out of the various covariates we explored—total number of species, plant richness, pollinator richness, link density (connectance), and the ratio of plant to pollinator richness—only the ratio of plant to pollinator richness was retained in the final model as determined by the AICc (Table S4). 

```{r fig_explaining-n-driver, echo = FALSE, warning = FALSE, message = FALSE, fig.width = 3.245, fig.height = 3.2, fig.cap = "asdasd"}

par_res <- as.data.frame(residuals(manag_models@objects[[1]], "partial"))
names(par_res) <- paste0(make.names(names(par_res)), "_res")
par_res %<>%
  dplyr::bind_cols(manag_models@objects[[1]]$data)

p1 <- par_res %>%
  ggplot(aes(x = inv, y = inv_res)) +
  # facet_wrap(~type) +
  geom_boxplot(size = 0.3,
               colour = "grey10", outlier.shape = 21, outlier.size = 1) +
  fer_theme +
  scale_x_discrete(labels = c("uninvaded", "invaded"), name = "") +
  ylab(expression(paste(n[D], " partial residuals"))) +
  coord_flip() +
  theme(
        legend.position = "none",
				plot.margin = grid::unit(c(2, 1, 2, 0), "mm"), 
				# panel.grid.minor.x = element_blank(),
				panel.grid.minor.y = element_blank())

p2 <- par_res %>%
  ggplot(aes(x = n_pla/n_pol, y = I.n_pla.n_pol._res)) +
	geom_smooth(method = "lm", se = F, colour = "black", size = 0.5) +
	geom_point(shape = 21) + 
	fer_theme +
	scale_x_continuous(name = "ratio plant / pollinators") +
	scale_y_continuous(name = expression(paste(n[D], " partial residuals"))) 

cowplot::plot_grid(p1, p2, ncol = 1, align = "v")
# pdf("./paper/figures/fig_3.pdf", height = 1.7, width = 3.245, family = "Times", compress = F, title = "Figure 3")
# f3
# dev.off()
```

# Appendix 1: Glossary 

Driver node
  ~ An unmatched node in a maximal cardinality matching or a maximum matching. From the control perspective driver nodes are those to which external control signals must ble applied in order to gain full control of the network.
  
Matched/unmatched link
  ~ A link if said to be *matched* if it is part of a matching and *unmatched* otherwise.
  
Matched/unmatched node
  ~ A node is said to be *matched* if it is at the end of a matched link and *unmatched* otherwise.

Matching
  ~ A subset of links in which no two of them share a common starting or ending node.
  
Matching size
  ~ The number of matched links in a particular matching.
  
Matching weight
  ~ The sum of the weights of all matched links in a particular matching. 
  
Maximal cardinality matching
  ~ A matching with the largest possible size. In unweighted networks all maximal cardinality matchings are also maximum matchings.
  
Maximum matching
  ~ A matching with the largest possible size *and* weight. 

Superior node
  ~ The node at the start of a matched link. From the control perspective superior nodes compose the chain that propagate the control signal(s) trough the network.

# References